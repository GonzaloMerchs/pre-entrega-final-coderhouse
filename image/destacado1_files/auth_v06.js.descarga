window.onload=()=>{if(!_isAppPage()){window.google.accounts.id.initialize({client_id:'575783686381-0tl98vq12r95o4rcr39foo2qtb9qdgfp.apps.googleusercontent.com',callback:callbackLogin});const googleButtonsContainers=document.querySelectorAll('.google_login_button');let buttonWith=0;if(_isMobilePage()){const margin=window.outerWidth*2/100;buttonWith=window.outerWidth-(margin*2);}else{buttonWith=(window.location.pathname.indexOf('/registro')!==-1||window.location.pathname.indexOf('/ingresar')!==-1)?400:246;}
googleButtonsContainers.forEach((element)=>{google.accounts.id.renderButton(element,{type:'standard',theme:'outline',size:'large',text:'continue_with',shape:'rectangular',logo_alignment:'center',width:buttonWith,locale:'es_ES',});});if(window.showOneTap){google.accounts.id.prompt(continueWithNextIdp);}
revokePermissions();window.focus();window.addEventListener("blur",()=>{let googleIframe=document.activeElement;let googleIframeId=googleIframe.id.substring(0,3)==='gsi';if(googleIframe&&googleIframe.tagName==="IFRAME"&&googleIframeId){gaSendEvent('Google login','Intent');}});let googleButtons=document.querySelectorAll('.col-goo');googleButtons.forEach((element)=>{element.addEventListener('click',()=>{gaSendEvent('Google login','Intent');});});}
else{_setGoogleSocialCookie();}};_isAppPage=()=>{return /WebViewApp/i.test(navigator.userAgent);};_isMobilePage=()=>{if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){return true;}else{return false;}};revokePermissions=()=>{google.accounts.id.initialize({client_id:'575783686381-9gp7kqp1b53bhbnft7j8g48ctlr4uans.apps.googleusercontent.com',callback:callbackLogin});let button=document.querySelector('#revoke_google_account');if(button!==null){button.onclick=async()=>{const email=document.querySelector('#email').value;google.accounts.id.revoke(email,async done=>{console.log('consent revoked');const result=await fetch(button.getAttribute('data-url'),{method:'POST',mode:'cors',cache:'no-cache',credentials:'same-origin',headers:{'Content-Type':'application/json'},redirect:'follow',referrerPolicy:'no-referrer',body:JSON.stringify({email:email,})});try{console.log('REVOKE SUCCESS',await result.text());}catch(e){console.log('REVOKE ERROR',e);}});};}};callbackLogin=async(response)=>{_setGoogleSocialCookie();const responsePayload=jwt_decode(response.credential);const data={version:'v2',id:responsePayload.sub,full_name:responsePayload.name,given_name:responsePayload.given_name,family_name:responsePayload.family_name,picture:responsePayload.picture,email:responsePayload.email,client_id:response.clientId};try{const result=await fetch(window.URL_SOCIAL_GOOGLE_CONNECT,{method:'POST',mode:'cors',cache:'no-cache',credentials:'same-origin',headers:{'Content-Type':'application/json'},redirect:'follow',referrerPolicy:'no-referrer',body:JSON.stringify({'data':data})});gaSendEvent('Google login','Intent');gaSendEvent('Google one-tap','Success');_deleteCookie('socialRediect');const url=await result.json();window.location.assign(url['url']);}catch(e){console.error('Error on Google Login');gaSendEvent('Google one-tap','Failed');}};_setGoogleSocialCookie=()=>{let now=new Date();let time=now.getTime();const expireTime=time+1000*36000;now.setTime(expireTime);if(document.cookie.indexOf('socialRediect=https://tiendamia.com/br/checkout/cart/;')===-1&&window.location.href.indexOf('/ingresar')===-1){document.cookie=`socialRediect=${window.location.href};path=/;expires=${now.toGMTString()};`;}else if(sessionStorage.getItem('CURRENT_ACTION')==='PROCEED_TO_CHECKOUT'&&window.location.href.indexOf('/ingresar')!==-1){let baseStore=window.base_store==='uy'?'':('/'+window.base_store);document.cookie=`socialRediect=${window.location.origin+baseStore+'/checkout/cart'};path=/;expires=${now.toGMTString()};`;}};_deleteCookie=(name)=>{const date=new Date();date.setTime(date.getTime()+-1*24*60*60*1000);document.cookie=name+'=; expires='+date.toUTCString()+'; path=/';};continueWithNextIdp=(notification)=>{if(!window.isLoggedin){_setGoogleSocialCookie();if(notification.isDisplayed()){gaSendEvent('Google one-tap','Show');console.log('Google one-tap','Show');window.GOOGLE_LOGIN_TAP=true;try{coachmarkDelegateHide();}catch(e){console.log('page without coachmarkDelegateHide');}}else{if(notification.isNotDisplayed()){gaSendEvent('Google one-tap not displayed',notification.getNotDisplayedReason());console.log('Google one-tap not displayed',notification.getNotDisplayedReason());}
if(notification.isSkippedMoment()){gaSendEvent('Google one-tap','Canceled',notification.getSkippedReason());console.log('Google one-tap',notification.getSkippedReason());}}}};nativeCallback=(params)=>{console.log('nativeCallback',params);};